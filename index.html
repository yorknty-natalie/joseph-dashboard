<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="retail_data.js"></script>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-color: #3b82f6;
            --border-radius: 16px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .dashboard {
            width: 100%;
            max-width: 1000px;
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .date-selector-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: white;
            border-radius: 14px;
            box-shadow: var(--shadow);
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .nav-btn {
            background-color: var(--bg-color);
            border: 1px solid #e2e8f0;
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s ease;
            user-select: none;
        }

        .nav-btn:hover:not(.disabled) {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .nav-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .current-date-display {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 120px;
            text-align: center;
        }

        .card-sub-header {
            margin-bottom: 0.5rem;
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .chart-container {
            width: 100%;
            height: 180px;
            margin-top: 1rem;
        }

        .card-footer {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Economic Indicators Styles */
        .indicator-list {
            list-style: none;
            padding: 0;
            margin: 1.5rem 0 0 0;
        }

        /* Retail Intelligence Styles */
        .news-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0 0;
        }

        .news-item {
            padding: 1rem;
            background-color: #f1f5f9;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            border-left: 4px solid var(--accent-color);
        }

        .news-store {
            font-weight: 700;
            color: var(--accent-color);
            display: block;
            margin-bottom: 0.2rem;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
        }

        .news-headline {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
        }

        .news-summary {
            display: block;
            color: var(--text-secondary);
            line-height: 1.5;
            font-size: 0.8rem;
        }

        .trend-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .trend-item {
            background-color: #f0fdf4;
            border: 1px solid #dcfce7;
            padding: 0.75rem;
            border-radius: 8px;
        }

        .trend-title {
            display: block;
            font-weight: 700;
            color: #166534;
            font-size: 0.8rem;
            margin-bottom: 0.2rem;
            text-transform: uppercase;
        }

        .trend-desc {
            display: block;
            font-size: 0.75rem;
            color: #15803d;
            line-height: 1.4;
        }

        .indicator-item {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 1rem;
            gap: 0.4rem;
        }

        .indicator-item:last-child {
            margin-bottom: 0;
        }

        .indicator-label {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.2rem;
        }

        .indicator-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .indicator-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
            min-width: 50px;
        }

        .indicator-value {
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .expected-value {
            color: var(--text-secondary);
            font-weight: 400;
            font-size: 0.875rem;
        }

        .next-release-text {
            font-size: 0.7rem;
            color: #2563eb;
            font-weight: 600;
            margin-top: 0.2rem;
        }

        .indicator-history {
            margin-top: 0.6rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            padding-top: 0.6rem;
            border-top: 1px dashed #cbd5e1;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .dot-green { background-color: #10b981; }
        .dot-red { background-color: #ef4444; }
        .dot-gray { background-color: #94a3b8; }

        .status-positive { color: #10b981; }
        .status-negative { color: #ef4444; }
        .status-neutral { color: #64748b; }

        .trend-up::before { content: "↑"; }
        .trend-down::before { content: "↓"; }

        .trend-up, .trend-down {
            font-weight: 600;
        }

        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }

        .trend-up-bad { color: #ef4444; } /* For jobless claims up */
        .trend-down-good { color: #10b981; } /* For jobless claims down */

        /* Social Buzz Styles */
        .buzz-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0 0;
        }

        .buzz-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: #f0f9ff;
            border: 1px solid #e0f2fe;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .buzz-name {
            font-weight: 700;
            color: #0369a1;
            font-size: 0.85rem;
        }

        .buzz-rank {
            font-size: 0.7rem;
            font-weight: 600;
            color: #7dd3fc;
            background-color: #0c4a6e;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 0.5rem;
        }

        .buzz-desc {
            font-size: 0.75rem;
            color: #0e7490;
            display: block;
            margin-top: 0.2rem;
        }

        /* Prompt Box Styles */
        .prompt-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .prompt-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .copy-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .copy-btn:hover {
            background-color: #2563eb;
        }

        .prompt-text {
            font-size: 0.75rem;
            color: var(--text-primary);
            line-height: 1.5;
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #f1f5f9;
            max-height: 150px;
            overflow-y: auto;
            word-break: break-word;
        }

        .loader {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="dashboard">
        <!-- Combined US Dollar Overview Card -->
        <div class="card" id="usd-overview-card">
            <div class="card-header">
                <span class="card-title">US Dollar Overview</span>
                <div id="loader-usd" class="loader hidden"></div>
            </div>

            <!-- USD to TWD Section -->
            <div class="card-sub-header">
                <span class="indicator-label">USD to TWD Rate</span>
            </div>
            <div class="card-value" id="rate-value">--.--</div>
            <div class="chart-container" style="height: 150px;">
                <canvas id="rateChart"></canvas>
            </div>
            <div class="card-footer" style="margin-bottom: 1.5rem;">
                <span id="update-status-twd">Fetching live data...</span>
            </div>

            <!-- Divider -->
            <div style="border-top: 1px solid #f1f5f9; margin: 1.5rem 0;"></div>

            <!-- US Dollar Index (DXY) Section -->
            <div class="card-sub-header">
                <span class="indicator-label">US Dollar Index (DXY)</span>
            </div>
            <div class="card-value" id="dxy-value">--.--</div>
            <div class="chart-container" style="height: 150px;">
                <canvas id="dxyChart"></canvas>
            </div>
            <div class="card-footer">
                <span id="update-status-dxy">Fetching live data...</span>
            </div>
        </div>
        
        <!-- Economic Indicators Card -->
        <div class="card" id="economic-indicators-card">
            <div class="card-header">
                <span class="card-title">US Economic Health</span>
            </div>
            <div class="indicator-list">
                <!-- Consumer Sentiment -->
                <div class="indicator-item">
                    <div class="indicator-label">Consumer Sentiment</div>
                    <div class="indicator-row">
                        <span class="indicator-date">Jan 31</span>
                        <div class="indicator-value status-positive">
                            <span class="status-dot dot-green"></span> 56.4 <span class="expected-value">/ 54.0</span>
                        </div>
                    </div>
                    <div class="next-release-text">Next: Feb 13</div>
                    <div class="indicator-history">
                        <div class="indicator-row">
                            <span class="indicator-date">Dec 31</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 52.9 <span class="expected-value">/ 52.0</span>
                            </div>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-date">Nov 30</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 51.5 <span class="expected-value">/ 51.0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Initial Jobless Claims -->
                <div class="indicator-item">
                    <div class="indicator-label">Initial Jobless Claims</div>
                    <div class="indicator-row">
                        <span class="indicator-date">Jan 24</span>
                        <div class="indicator-value status-negative">
                            <span class="status-dot dot-red"></span> 209K <span class="expected-value">/ 205K</span>
                        </div>
                    </div>
                    <div class="next-release-text">Next: Feb 05</div>
                    <div class="indicator-history">
                        <div class="indicator-row">
                            <span class="indicator-date">Jan 22</span>
                            <div class="indicator-value status-negative">
                                <span class="status-dot dot-red"></span> 210K <span class="expected-value">/ 208K</span>
                            </div>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-date">Jan 15</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 208K <span class="expected-value">/ 210K</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manufacturing PMI -->
                <div class="indicator-item">
                    <div class="indicator-label">Manufacturing PMI</div>
                    <div class="indicator-row">
                        <span class="indicator-date">Jan 26</span>
                        <div class="indicator-value status-positive">
                            <span class="status-dot dot-green"></span> 51.9 <span class="expected-value">/ 51.0</span>
                        </div>
                    </div>
                    <div class="next-release-text">Next: Feb 02</div>
                    <div class="indicator-history">
                        <div class="indicator-row">
                            <span class="indicator-date">Dec 01</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 50.8 <span class="expected-value">/ 50.5</span>
                            </div>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-date">Nov 03</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 50.2 <span class="expected-value">/ 50.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Retail & Consumer Card -->
        <div class="card" id="retail-indicators-card">
            <div class="card-header">
                <span class="card-title">Retail Buying Power</span>
            </div>
            <div class="indicator-list">
                <!-- Redbook Index -->
                <div class="indicator-item">
                    <div class="indicator-label">Redbook Index (YoY)</div>
                    <div class="indicator-row">
                        <span class="indicator-date">Jan 24</span>
                        <div class="indicator-value status-positive">
                            <span class="status-dot dot-green"></span> 7.1% <span class="expected-value">/ 6.5%</span>
                        </div>
                    </div>
                    <div class="next-release-text">Next: Feb 03</div>
                    <div class="indicator-history">
                        <div class="indicator-row">
                            <span class="indicator-date">Jan 20</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 5.5% <span class="expected-value">/ 5.0%</span>
                            </div>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-date">Jan 13</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 5.2% <span class="expected-value">/ 5.0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Retail Sales -->
                <div class="indicator-item">
                    <div class="indicator-label">Retail Sales (MoM)</div>
                    <div class="indicator-row">
                        <span class="indicator-date">Nov 15</span>
                        <div class="indicator-value status-positive">
                            <span class="status-dot dot-green"></span> 0.6% <span class="expected-value">/ 0.4%</span>
                        </div>
                    </div>
                    <div class="next-release-text">Next: Feb 13</div>
                    <div class="indicator-history">
                        <div class="indicator-row">
                            <span class="indicator-date">Dec 16</span>
                            <div class="indicator-value status-negative">
                                <span class="status-dot dot-red"></span> -0.1% <span class="expected-value">/ 0.1%</span>
                            </div>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-date">Nov 15</span>
                            <div class="indicator-value status-positive">
                                <span class="status-dot dot-green"></span> 0.5% <span class="expected-value">/ 0.3%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Producer Price Index -->
                <div class="indicator-item">
                    <div class="indicator-label">Producer Price Index (PPI)</div>
                    <div class="indicator-row">
                        <span class="indicator-date">Jan 13</span>
                        <div class="indicator-value status-negative">
                            <span class="status-dot dot-red"></span> 3.0% <span class="expected-value">/ 2.7%</span>
                        </div>
                    </div>
                    <div class="next-release-text">Next: Feb 12</div>
                    <div class="indicator-history">
                        <div class="indicator-row">
                            <span class="indicator-date">Dec 11</span>
                            <div class="indicator-value status-neutral">
                                <span class="status-dot dot-gray"></span> 3.0% <span class="expected-value">/ 3.0%</span>
                            </div>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-date">Nov 12</span>
                            <div class="indicator-value status-negative">
                                <span class="status-dot dot-red"></span> 3.2% <span class="expected-value">/ 2.8%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Intelligence Section Header -->
        <div class="date-selector-container">
            <div id="prev-date-btn" class="nav-btn" onclick="navigateDate(1)">‹</div>
            <div class="current-date-display" id="intel-current-date">---</div>
            <div id="next-date-btn" class="nav-btn" onclick="navigateDate(-1)">›</div>
        </div>

        <!-- Retail Intelligence Card -->
        <div class="card" id="retail-intelligence-card">
            <div class="card-header">
                <span class="card-title">Retail Intelligence</span>
                <span class="indicator-date" id="retail-update-date">Feb 01</span>
            </div>
            
            <div style="margin-top: 1rem;">
                <span class="detail-label" style="display: block; margin-bottom: 0.5rem;">Market Trends Briefing</span>
                <div id="trends-container" class="trend-container">
                    <!-- Trends will be injected here -->
                </div>
            </div>

            <div style="margin-top: 1.5rem;">
                <span class="detail-label" style="display: block; margin-bottom: 0.5rem;">Daily Retailer Reports</span>
                <ul class="news-list" id="news-container">
                    <!-- News will be injected here -->
                </ul>
            </div>
        </div>

        <!-- Social Buzz (X Trends) Card -->
        <div class="card" id="x-trends-card">
            <div class="card-header">
                <span class="card-title">Social Buzz (X Trends)</span>
                <span class="indicator-date">Last 48h</span>
            </div>
            <ul class="buzz-list" id="buzz-container">
                <!-- X Trends will be injected here -->
            </ul>

            <!-- Image Generation Prompt Section -->
            <div class="prompt-box">
                <div class="prompt-header">
                    <span class="prompt-label">Image Generation Prompt</span>
                    <button class="copy-btn" id="copy-prompt-btn">Copy Prompt</button>
                </div>
                <div class="prompt-text" id="prompt-display">
                    Generating prompt based on trends...
                </div>
            </div>
        </div>

        <!-- Placeholder for future information -->
        <div class="card" style="display: flex; align-items: center; justify-content: center; border: 2px dashed #e2e8f0; background: transparent; box-shadow: none;">
            <span style="color: var(--text-secondary); font-weight: 500;">+ Add Component</span>
        </div>
    </div>

    <script>
        let rateChart, dxyChart;

        async function fetchLiveRates() {
            const rateElement = document.getElementById('rate-value');
            const dxyElement = document.getElementById('dxy-value');
            const loaderUsd = document.getElementById('loader-usd');
            const statusTwd = document.getElementById('update-status-twd');
            const statusDxy = document.getElementById('update-status-dxy');

            if (loaderUsd) loaderUsd.classList.remove('hidden');
            
            try {
                const response = await fetch('https://open.er-api.com/v6/latest/USD');
                const data = await response.json();
                
                if (data.result === 'success') {
                    // Update TWD
                    const twdRate = data.rates.TWD.toFixed(2);
                    rateElement.textContent = `NT$ ${twdRate}`;
                    statusTwd.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;

                    // Update DXY
                    const eur = data.rates.EUR;
                    const jpy = data.rates.JPY;
                    const gbp = data.rates.GBP;
                    const cad = data.rates.CAD;
                    const sek = data.rates.SEK;
                    const chf = data.rates.CHF;

                    const dxy = 50.14348112 * 
                                Math.pow(eur, 0.576) * 
                                Math.pow(jpy, 0.136) * 
                                Math.pow(gbp, 0.119) * 
                                Math.pow(cad, 0.091) * 
                                Math.pow(sek, 0.042) * 
                                Math.pow(chf, 0.036);
                    
                    dxyElement.textContent = dxy.toFixed(2);
                    statusDxy.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                }

                await updateCharts();

            } catch (error) {
                console.error('Error fetching live data:', error);
                rateElement.textContent = 'Error';
                dxyElement.textContent = 'Error';
            } finally {
                if (loaderUsd) loaderUsd.classList.add('hidden');
            }
        }

        async function updateCharts() {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { font: { size: 10 }, color: '#64748b' } },
                    y: { grid: { color: '#f1f5f9' }, ticks: { font: { size: 10 }, color: '#64748b' } }
                }
            };

            const months = ['Jan 25', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan 26'];

            // TWD Chart
            const twdValues = [32.97, 32.68, 32.94, 32.37, 30.35, 29.54, 29.34, 30.09, 30.30, 30.70, 30.70, 31.34, 31.55];
            const ctxTwd = document.getElementById('rateChart').getContext('2d');
            if (rateChart) rateChart.destroy();
            rateChart = new Chart(ctxTwd, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        data: twdValues,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3
                    }]
                },
                options: commonOptions
            });

            // DXY Chart
            const dxyValues = [109.44, 107.85, 103.74, 99.64, 101.13, 98.68, 98.34, 98.10, 97.74, 98.92, 99.39, 98.83, 99.06];
            const ctxDxy = document.getElementById('dxyChart').getContext('2d');
            if (dxyChart) dxyChart.destroy();
            dxyChart = new Chart(ctxDxy, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        data: dxyValues,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3
                    }]
                },
                options: commonOptions
            });
        }

        let availableDates = [];
        let currentDateIndex = 0;

        function populateRetailIntelligence(date) {
            if (typeof retailHistory === 'undefined') return;
            
            const data = retailHistory[date];
            if (!data) return;

            document.getElementById('retail-update-date').textContent = date;
            document.getElementById('intel-current-date').textContent = date;

            const trendsContainer = document.getElementById('trends-container');
            trendsContainer.innerHTML = data.trends.map(trend => `
                <div class="trend-item">
                    <span class="trend-title">${trend.title}</span>
                    <span class="trend-desc">${trend.description}</span>
                </div>
            `).join('');

            const newsContainer = document.getElementById('news-container');
            newsContainer.innerHTML = data.news.map(item => `
                <li class="news-item">
                    <span class="news-store">${item.store}</span>
                    <span class="news-headline">${item.headline}</span>
                    <span class="news-summary">${item.summary}</span>
                </li>
            `).join('');

            const buzzContainer = document.getElementById('buzz-container');
            buzzContainer.innerHTML = data.xTrends.map((trend, index) => `
                <li class="buzz-item">
                    <div>
                        <span class="buzz-rank">${index + 1}</span>
                        <span class="buzz-name">${trend.name}</span>
                        <span class="buzz-desc">${trend.desc}</span>
                    </div>
                </li>
            `).join('');

            // Set up Image Prompt based on selected date's trends
            const promptDisplay = document.getElementById('prompt-display');
            const ornamentShapes = [
                "a gold and black wrestling belt", "a stone-gray castle tower", "a blue and white police cruiser",
                "a vibrant pink high-fashion heel", "a silver and chrome vintage microphone", "a pair of black and red MMA gloves",
                "a warm ginger-colored sleeping kitten", "a clear glass Shanghai tower with a bright red Santa hat",
                "a large maize and blue college-style letter M", "a neon green and black professional football boot"
            ];

            let promptList = data.xTrends.map((t, i) => `${i+1}) ${ornamentShapes[i]} (${t.name})`).join('. ');
            const imagePrompt = `A single high-quality product photo of ten distinct molded glass Christmas ornaments arranged in two clean rows on a solid white background. Each ornament is a unique custom shape with vibrant colors representing its theme: ${promptList}. Each ornament has its corresponding #tag name printed in small, clean, professional black typography positioned neatly underneath the base of the ornament, not overlapping the glass. All ornaments are made of premium, colorful, and translucent molded glass, isolated on a pure white background.`;
            
            promptDisplay.textContent = imagePrompt;
            window.currentImagePrompt = imagePrompt;

            // Update button states
            document.getElementById('prev-date-btn').classList.toggle('disabled', currentDateIndex >= availableDates.length - 1);
            document.getElementById('next-date-btn').classList.toggle('disabled', currentDateIndex <= 0);
        }

        function initDateSelector() {
            if (typeof retailHistory === 'undefined') return;
            availableDates = Object.keys(retailHistory).sort().reverse();
            
            if (availableDates.length > 0) {
                currentDateIndex = 0;
                populateRetailIntelligence(availableDates[0]);
            }
        }

        function navigateDate(direction) {
            const newIndex = currentDateIndex + direction;
            if (newIndex >= 0 && newIndex < availableDates.length) {
                currentDateIndex = newIndex;
                populateRetailIntelligence(availableDates[currentDateIndex]);
            }
        }

        document.getElementById('copy-prompt-btn').onclick = () => {
            const text = window.currentImagePrompt || document.getElementById('prompt-display').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copy-prompt-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        };

        fetchLiveRates();
        initDateSelector();
        setInterval(fetchLiveRates, 300000);
    </script>
</body>
</html>
